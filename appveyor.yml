image: Visual Studio 2017

install:
  - set PROJECT_DIR=Desktop/Fallturm
  - set QTDIR=C:\Qt\5.10.1\mingw53_32
  - choco install -y InnoSetup
  - set PATH=%QTDIR%\bin;C:\Qt\Tools\mingw530_32\bin;%PATH%;"C:\Program Files (x86)\Inno Setup 5"
build_script:
  - cd Desktop/Fallturm
  - qmake Fallturm.pro
  - mingw32-make
after_build:
  - windeployqt release/Fallturm.exe
  - cmd: cp LICENSE release/LICENSE.txt"
  - iscc innosetup.iss
  - rm release/*.o
  - rm release/*.cpp

artifacts:
  - path: Desktop/Fallturm/setup/setup.exe
  - path: Desktop/Fallturm/release
    type: zip

deploy:
  release: Fallturm-v$(appveyor_build_version)
  description: 'Fallturm-Software Release'
  provider: GitHub
  auth_token:
    secure: dQVcTF6DiR2PNMN669wx9hUaz0/5gqIpE56zDXOW94KFmz2oFn9Qbd9ApmsQ6Wn9 
  draft: false
  prerelease: false
  on:
    branch: master
appveyor_repo_tag: true